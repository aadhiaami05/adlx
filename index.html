<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Video Room</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #3b82f6; --text: #f8fafc; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); }
        
        /* Video Grid - Automatically fits 2, 3, or 4+ people */
        #video-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 15px; padding: 20px; height: 80vh; 
        }
        .video-wrapper { position: relative; background: #000; border-radius: 12px; overflow: hidden; height: 100%; }
        video { width: 100%; height: 100%; object-fit: cover; }
        
        .room-info { padding: 20px; background: var(--card); text-align: center; border-bottom: 1px solid #334155; }
        .controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 50px; backdrop-filter: blur(10px); }
        button { padding: 10px 20px; border-radius: 20px; border: none; cursor: pointer; background: var(--accent); color: white; font-weight: bold; }
    </style>
</head>
<body>

<div class="room-info">
    <h2 id="room-title">Joining Room...</h2>
    <p>Share this link to invite others: <b id="room-link" style="color:var(--accent)"></b></p>
</div>

<div id="video-grid">
    <div class="video-wrapper" id="local-container">
        <video id="localVideo" autoplay playsinline muted></video>
        <div style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.5); padding:2px 8px; border-radius:5px;">You</div>
    </div>
</div>

<div class="controls">
    <button onclick="toggleAudio()">ðŸŽ¤ Mic</button>
    <button onclick="toggleVideo()">ðŸ“· Cam</button>
    <button style="background:#ef4444" onclick="location.href='/'">Leave</button>
</div>

<script>
    // 1. Setup Room Name from URL
    let roomID = window.location.hash.substring(1);
    if (!roomID) {
        roomID = Math.random().toString(36).substring(7);
        window.location.hash = roomID;
    }
    document.getElementById('room-title').innerText = "Room: " + roomID;
    document.getElementById('room-link').innerText = window.location.href;

    const peer = new Peer(); // In a real app, you'd prefix this with the roomID
    const videoGrid = document.getElementById('video-grid');
    const peers = {}; // Keep track of people connected
    let myStream;

    // 2. Get Camera
    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
        myStream = stream;
        document.getElementById('localVideo').srcObject = stream;

        // Answer calls from new people joining
        peer.on('call', call => {
            call.answer(stream);
            const video = document.createElement('video');
            call.on('stream', userStream => addVideoStream(video, userStream, call.peer));
        });

        // 3. Simple "Discovery" Logic 
        // Note: PeerJS Cloud doesn't have "Rooms" built-in, so for a 100% 
        // HTML solution, you still need to paste the FIRST person's Peer ID 
        // or use a small backend. 
    });

    function addVideoStream(video, stream, peerId) {
        if (peers[peerId]) return; // Don't add same person twice
        const wrapper = document.createElement('div');
        wrapper.className = 'video-wrapper';
        wrapper.id = peerId;
        video.srcObject = stream;
        video.autoplay = true;
        video.playsInline = true;
        wrapper.append(video);
        videoGrid.append(wrapper);
        peers[peerId] = stream;
    }

    // Toggle Functions
    function toggleAudio() { myStream.getAudioTracks()[0].enabled = !myStream.getAudioTracks()[0].enabled; }
    function toggleVideo() { myStream.getVideoTracks()[0].enabled = !myStream.getVideoTracks()[0].enabled; }

</script>
</body>
</html>
